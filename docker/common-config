listen 4000;
listen [::]:4000;

charset utf-8;
client_body_buffer_size 64m;
client_max_body_size    64M;

access_log /dev/stdout;
error_log  /dev/stdout info;

gzip              on;
gzip_vary         on;
gzip_proxied      any;
gzip_comp_level   9;
gzip_buffers      16 8k;
gzip_http_version 1.1;
gzip_min_length   256;
gzip_types        application/javascript application/json application/xml font/woff font/woff2 image/svg+xml image/x-icon text/css text/javascript text/plain text/xml;

keepalive_requests 1000;

large_client_header_buffers 4 32k;

proxy_buffer_size       512k;
proxy_buffers           8 512k;
proxy_busy_buffers_size 512k;
proxy_connect_timeout   60s;
proxy_http_version      1.1;
proxy_read_timeout      300s;
proxy_send_timeout      300s;
proxy_set_header        Host               $host;
proxy_set_header        X-Forwarded-For    $proxy_add_x_forwarded_for;
proxy_set_header        X-Forwarded-Host   $host;
proxy_set_header        X-Forwarded-Server $host;
proxy_set_header        X-Forwarded-Proto  https;
proxy_set_header        X-Real-IP          $remote_addr;

real_ip_header    X-Forwarded-For;
real_ip_recursive on;

send_timeout  300s;
sendfile      on;
server_tokens on;

tcp_nopush  on;
tcp_nodelay on;

location /status {
  default_type text/html;
  return 200 "<!DOCTYPE html><h1>Not too bad!</h1>\n";
  access_log off;
}

location /status {
  proxy_pass http://app_api/schemas/repository;
}


location ~* (\.php|\.asp|\.aspx|\.cgi|\.pl|\.exe|\.sh|\.bat|\.cmd|\.py|\.rb|\.jar|\.war|\.dll|\.bin|config\.inc\.php|config\.ini|\.env|\.git|\.svn|\.hg|\.bzr|\.DS_Store|thumbs\.db|desktop\.ini|backup\.zip|backup\.tar|\.bak|\.sql|setup\.php|install\.php|setup-config\.php|web\.config|installer\.php|update\.php|install\.sql|install\.txt|index\.php\.bak) {
    deny all;
}

location ~* (wp-admin|wp-includes|wp-content|xmlrpc\.php|wp-login\.php|wp-config\.php|wp-cron\.php|wp-trackback\.php|wp-comments-post\.php|wp-links-opml\.php) {
    deny all;
}

#location ~ ^/repositories/\d+/resources/\d+/infinite/waypoints {
#    limit_req zone=waypoints_limit burst=10 nodelay;
#    try_files $uri $uri/ =404;
#}
