locals {
  assign_public_ip         = var.assign_public_ip
  arclight_url             = var.arclight_url
  capacity_provider        = var.capacity_provider
  storage                  = var.storage
  cluster_id               = var.cluster_id
  cpu                      = var.cpu
  custom_env_cfg           = var.custom_env_cfg
  custom_secrets_cfg       = var.custom_secrets_cfg
  iam_ecs_task_role_arn    = var.iam_ecs_task_role_arn
  img                      = var.img
  instances                = var.instances
  secret_key_base          = random_bytes.secret_key_base.base64
  listener_arn             = var.listener_arn
  listener_priority        = var.listener_priority
  memory                   = var.memory
  name                     = var.name
  network_mode             = var.network_mode
  placement_strategies     = var.placement_strategies
  port                     = var.port
  requires_compatibilities = var.requires_compatibilities
  security_group_id        = var.security_group_id
  solr_url                 = var.solr_url
  subnets                  = var.subnets
  swap_size                = 2048
  tags                     = var.tags
  target_type              = var.target_type
  timezone                 = var.timezone
  vpc_id                   = var.vpc_id
  
  rails_assume_ssl         = var.rails_assume_ssl
  rails_env                = var.rails_env
  rails_force_ssl          = var.rails_force_ssl
  rails_log_to_stdout      = var.rails_log_to_stdout
  rails_serve_static_files = var.rails_serve_static_files

  task_config = {
    capacity_provider         = local.capacity_provider
    custom_env_cfg            = local.custom_env_cfg
    custom_secrets_cfg        = local.custom_secrets_cfg
    arclight_url              = local.arclight_url
    img                       = local.img
    log_group                 = aws_cloudwatch_log_group.this.name
    memory                    = local.memory
    name                      = local.name
    network_mode              = local.network_mode
    port                      = local.port
    region                    = data.aws_region.current.name
    secret_key_base           = local.secret_key_base
    solr_url                  = local.solr_url
    swap_size                 = local.swap_size
    timezone                  = local.timezone
    rails_assume_ssl          = local.rails_assume_ssl
    rails_env                 = local.rails_env
    rails_force_ssl           = local.rails_force_ssl
    rails_log_to_stdout       = local.rails_log_to_stdout 
    rails_serve_static_files  = local.rails_serve_static_files
  }
}
